// Kleis Plotting Showcase
// Demonstrating Lilaq-style plotting with v0.96 named arguments
//
// Original Lilaq example:
// #let xs = range(4)
// #let ys1 = (1.35, 3, 2.1, 4)
// #let ys2 = (1.4, 3.3, 1.9, 4.2)
// #let yerr1 = (0.2, 0.3, 0.5, 0.4)
// #let yerr2 = (0.3, 0.3, 0.4, 0.7)
//
// #lq.diagram(
//   width: 5cm,
//   legend: (position: left + top),
//   lq.bar(xs, ys1, offset: -0.2, width: 0.4, label: [Left]),
//   lq.bar(xs, ys2, offset: 0.2, width: 0.4, label: [Right]),
//   lq.plot(xs.map(x => x - 0.2), ys1, yerr: yerr1, color: black, stroke: none),
//   lq.plot(xs.map(x => x + 0.2), ys2, yerr: yerr2, color: black, stroke: none)
// )

import "stdlib/prelude.kleis"

// =============================================================================
// Grouped Bar Chart with Error Bars
// =============================================================================

example "Grouped bars with error bars (Lilaq replication)" {
    out("Grouped bar chart with error bars")
    out("Replicating: https://lilaq.org/docs/bar")
    out("")
    
    // Data
    let xs = [0, 1, 2, 3]
    let ys1 = [1.35, 3, 2.1, 4]
    let ys2 = [1.4, 3.3, 1.9, 4.2]
    let yerr1 = [0.2, 0.3, 0.5, 0.4]
    let yerr2 = [0.3, 0.3, 0.4, 0.7]
    
    // Offset x-coordinates for error bars (like Lilaq's .map())
    let xs_left = list_map(位 x . x - 0.2, xs)
    let xs_right = list_map(位 x . x + 0.2, xs)
    
    // Diagram with named arguments
    diagram(
        bar(xs, ys1, offset = -0.2, width = 0.4, label = "Left"),
        bar(xs, ys2, offset = 0.2, width = 0.4, label = "Right"),
        plot(xs_left, ys1, yerr = yerr1, color = "black", stroke = "none"),
        plot(xs_right, ys2, yerr = yerr2, color = "black", stroke = "none"),
        width = 5,
        legend_position = "left + top"
    )
}

// =============================================================================
// Bar Plot with Numbers
// =============================================================================
// Original Lilaq:
// #let xs = range(9)
// #let ys = (12, 51, 23, 36, 38, 15, 10, 22, 86)
// #lq.diagram(
//   width: 9cm,
//   xaxis: (subticks: none),
//   lq.bar(xs, ys),
//   ..xs.zip(ys).map(((x, y)) => {
//     let align = if y > 12 { top } else { bottom }
//     lq.place(x, y, pad(0.2em)[#y], align: align)
//   })
// )

example "Bar plot with xaxis options" {
    out("Bar plot with numeric data and xaxis: (subticks: none)")
    out("")
    
    let xs = [0, 1, 2, 3, 4, 5, 6, 7, 8]
    let ys = [12, 51, 23, 36, 38, 15, 10, 22, 86]
    
    diagram(
        bar(xs, ys),
        width = 9,
        xaxis_subticks = "none"
    )
}

example "Demonstrating list_zip and conditionals" {
    out("list_zip combines two lists into pairs:")
    let xs = [0, 1, 2]
    let ys = [10, 20, 30]
    out(list_zip(xs, ys))
    
    out("")
    out("Conditional alignment based on value:")
    let values = [5, 20, 10, 50]
    out(list_map(位 y . if y > 12 then "top" else "bottom", values))
}

// =============================================================================
// Bar Plot with Numbers - FULL LILAQ REPLICATION (DYNAMIC)
// =============================================================================
// This is the EXACT replication of:
// https://lilaq.org/docs/bar (Bar plot with numbers example)
//
// Original Lilaq:
// #let xs = range(9)
// #let ys = (12, 51, 23, 36, 38, 15, 10, 22, 86)
// #lq.diagram(
//   width: 9cm,
//   xaxis: (subticks: none),
//   lq.bar(xs, ys),
//   ..xs.zip(ys).map(((x, y)) => {
//     let align = if y > 12 { top } else { bottom }
//     lq.place(x, y, pad(0.2em)[#y], align: align)
//   })
// )

example "Bar plot with text annotations (EXACT Lilaq replication)" {
    out("Bar plot with text annotations - EXACT Lilaq replication")
    out("")
    
    let xs = [0, 1, 2, 3, 4, 5, 6, 7, 8]
    let ys = [12, 51, 23, 36, 38, 15, 10, 22, 86]
    
    // Dynamic annotation generation - exactly like Lilaq
    let annotations = list_map(位 p . 
        let x = fst(p) in
        let y = snd(p) in
        let align = if y > 12 then "top" else "bottom" in
        place(x, y, y, align = align)
    , list_zip(xs, ys))
    
    // diagram() now accepts a list of PlotElements (like Lilaq's spread operator)
    diagram(
        bar(xs, ys),
        annotations,  // List of place() elements
        width = 9,
        xaxis_subticks = "none"
    )
}

