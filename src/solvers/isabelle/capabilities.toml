# Isabelle/HOL Backend Capabilities
# 
# This file describes what the Isabelle solver backend can do,
# what theories are available, and connection parameters.

[backend]
name = "isabelle"
display_name = "Isabelle/HOL"
version = "2025-1"
description = "Interactive theorem prover with full induction and higher-order logic"

# What Kleis can delegate to this backend
[capabilities]
# Core verification capabilities
induction = true
termination = true
higher_order = true
quantifier_elimination = true
interactive_proofs = true

# What this backend is good at (self-contained, no reference to other backends)
[capabilities.strengths]
strengths = [
    "Induction over natural numbers and datatypes",
    "Termination proofs for recursive definitions",
    "Higher-order unification",
    "Access to AFP library (800+ formalized theories)",
    "Proof objects (can extract certified code)",
]

# What this backend is slower at
[capabilities.limitations]
limitations = [
    "Decidable theories (SAT/SMT)",
    "Requires more user guidance for complex proofs",
]

# Server connection settings
[server]
default_host = "127.0.0.1"
default_port = 0
timeout_session_start = 120
timeout_use_theories = 300
timeout_default = 30

# How to find/start Isabelle
[server.discovery]
search_paths = [
    "/Applications/Isabelle2025-1.app/bin/isabelle",
    "/Applications/Isabelle2025.app/bin/isabelle",
    "/usr/local/bin/isabelle",
    "~/.local/bin/isabelle",
]
env_var = "ISABELLE_HOME"

# Available base logics/sessions
[sessions]
default = "HOL"

[sessions.available.Pure]
description = "Minimal logic framework"
use_for = ["meta-theory"]

[sessions.available.HOL]
description = "Higher-Order Logic (standard)"
use_for = ["most proofs", "AFP"]

[sessions.available."HOL-Analysis"]
description = "Real analysis, topology"
use_for = ["calculus", "limits"]

[sessions.available."HOL-Algebra"]
description = "Abstract algebra"
use_for = ["groups", "rings", "fields"]

[sessions.available."HOL-Number_Theory"]
description = "Number theory"
use_for = ["primes", "divisibility"]

[sessions.available."HOL-Library"]
description = "Extended standard library"
use_for = ["general"]

# AFP (Archive of Formal Proofs) sessions
[afp]
description = "Archive of Formal Proofs - 800+ peer-reviewed formalizations"
url = "https://www.isa-afp.org/"

# AFP entries relevant to Kleis
[afp.entries.Neural_Networks]
description = "Formalized feed-forward neural networks with TensorFlow.js import"
url = "https://www.isa-afp.org/entries/Neural_Networks.html"
use_for = ["AI/ML verification", "Lipschitz bounds", "activation functions"]
authors = ["Achim D. Brucker", "Amy Stell"]

[afp.entries.Petri_Nets]
description = "Petri net formalization"
url = "https://www.isa-afp.org/entries/Petri_Nets.html"
use_for = ["state machines", "mutual exclusion", "deadlock freedom"]

[afp.entries.Graph_Theory]
description = "Graph theory fundamentals"
url = "https://www.isa-afp.org/entries/Graph_Theory.html"
use_for = ["graphs", "paths", "connectivity"]

[afp.entries.Jordan_Normal_Form]
description = "Matrices and Jordan normal form"
url = "https://www.isa-afp.org/entries/Jordan_Normal_Form.html"
use_for = ["linear algebra", "eigenvalues", "matrix theory"]

[afp.entries.Interval_Analysis]
description = "Interval arithmetic"
url = "https://www.isa-afp.org/entries/Interval_Arithmetic_Word32.html"
use_for = ["numerical bounds", "floating point"]

# Translation rules: Kleis → Isar
[translation.types]
"ℕ" = "nat"
"ℤ" = "int"
"ℝ" = "real"
"Bool" = "bool"
"List(T)" = "'a list"
"Option(T)" = "'a option"

[translation.constructs]
structure = "locale"
axiom = "assumes"
define = "definition"
data = "datatype"
"∀" = "∀"
"∃" = "∃"
"→" = "⟹"
"×" = "×"
"λ" = "λ"

[translation.operations]
"+" = "(+)"
"-" = "(-)"
"*" = "(*)"
"/" = "(/)"
"=" = "(=)"
"≠" = "(≠)"
"<" = "(<)"
">" = "(>)"
"≤" = "(≤)"
"≥" = "(≥)"
"∧" = "(∧)"
"∨" = "(∨)"
"¬" = "(¬)"

# Commands supported
[commands]
verify = "use_theories"
build = "session_build"
check = "use_theories"

# Backend selection (NOT grammar - via CLI/config)
# 
# Same Kleis code works with any backend:
#   kleis --check file.kleis                  # Default: Z3
#   kleis --check --solver=isabelle file.kleis # Use Isabelle
#   KLEIS_SOLVER=isabelle kleis --check file.kleis
#
# The SolverBackend trait handles translation internally.
# No grammar changes required.

[cli]
flag = "--solver=isabelle"
env_var = "KLEIS_SOLVER"
config_key = "solver.backend"

# Internal translation (handled by IsabelleBackend, not user-facing)
[internal.workflow]
steps = [
    "1. Kleis parses file normally (no special syntax)",
    "2. IsabelleBackend selected via CLI/config",
    "3. Backend translates Kleis AST → Isar theory file",
    "4. Backend calls Isabelle server with use_theories",
    "5. Backend interprets result → VerificationResult",
]
