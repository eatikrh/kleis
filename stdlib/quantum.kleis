// Kleis Standard Library - Quantum Mechanics
// Hilbert space operations and quantum formalism
//
// This file defines quantum mechanical structures following ADR-016.
//
// Domain: Quantum mechanics operates in Hilbert space - a complex vector
// space with inner product structure. States are vectors, observables are
// Hermitian operators, measurements follow Born rule.

/* Quantum State Types
 * 
 * Ket |ÏˆâŸ©: State vector in Hilbert space (column vector)
 * Bra âŸ¨Ï†|: Dual vector (row vector, conjugate transpose of ket)
 * 
 * In Dirac notation:
 *   |ÏˆâŸ© âˆˆ â„‹ (Hilbert space)
 *   âŸ¨Ï†| âˆˆ â„‹* (dual space)
 * 
 * Type parameters:
 *   - dim: Hilbert space dimension (2 for qubit, âˆ for continuous)
 *   - T: element type (typically â„‚)
 */

/* Ket Vector - Quantum State
 * 
 * |ÏˆâŸ© represents a quantum state vector.
 * 
 * Properties:
 *   - Normalized: âŸ¨Ïˆ|ÏˆâŸ© = 1
 *   - Superposition: Î±|ÏˆâŸ© + Î²|Ï†âŸ© is valid
 *   - Probability: |âŸ¨Ï†|ÏˆâŸ©|Â² is probability of measuring |Ï†âŸ© in state |ÏˆâŸ©
 * 
 * Type: Ket(dim, â„‚) - complex vector in dim-dimensional Hilbert space
 */
structure Ket(dim: Nat, T) {
    operation normalize : Ket(dim, T) â†’ Ket(dim, T)
    operation scale : T â†’ Ket(dim, T) â†’ Ket(dim, T)
}

implements Ket(dim, â„‚) {
    operation normalize = builtin_ket_normalize
    operation scale = builtin_ket_scale
}

/* Bra Vector - Dual State
 * 
 * âŸ¨Ï†| is the conjugate transpose of |Ï†âŸ©.
 * 
 * Relationship: âŸ¨Ï†| = (|Ï†âŸ©)â€ 
 * 
 * Type: Bra(dim, â„‚) - dual vector (row vector)
 */
structure Bra(dim: Nat, T) {
    operation conjugate : Ket(dim, T) â†’ Bra(dim, T)
}

implements Bra(dim, â„‚) {
    operation conjugate = builtin_bra_from_ket
}

/* Inner Product - Probability Amplitude
 * 
 * âŸ¨Ï†|ÏˆâŸ© is the inner product (overlap) between states.
 * 
 * Properties:
 *   - Returns complex number: âŸ¨Ï†|ÏˆâŸ© âˆˆ â„‚
 *   - Conjugate symmetric: âŸ¨Ï†|ÏˆâŸ© = âŸ¨Ïˆ|Ï†âŸ©*
 *   - Probability: |âŸ¨Ï†|ÏˆâŸ©|Â² is probability
 *   - Normalization: âŸ¨Ïˆ|ÏˆâŸ© = 1 for normalized states
 * 
 * Physical meaning: Probability amplitude for transition from |ÏˆâŸ© to |Ï†âŸ©
 */
structure InnerProduct(dim: Nat) {
    operation inner : Bra(dim, â„‚) â†’ Ket(dim, â„‚) â†’ â„‚
}

implements InnerProduct(dim) {
    operation inner = builtin_inner_product
}

/* Outer Product - Projection Operator
 * 
 * |ÏˆâŸ©âŸ¨Ï†| is a projection operator (dyad).
 * 
 * Properties:
 *   - Returns operator: |ÏˆâŸ©âŸ¨Ï†| : â„‹ â†’ â„‹
 *   - Action: (|ÏˆâŸ©âŸ¨Ï†|)|Ï‡âŸ© = |ÏˆâŸ©âŸ¨Ï†|Ï‡âŸ© = âŸ¨Ï†|Ï‡âŸ©|ÏˆâŸ©
 *   - Projection: |ÏˆâŸ©âŸ¨Ïˆ| projects onto state |ÏˆâŸ©
 *   - Resolution of identity: Î£áµ¢ |Ïˆáµ¢âŸ©âŸ¨Ïˆáµ¢| = ğŸ™
 * 
 * Physical meaning: Operator that projects any state onto |ÏˆâŸ© direction
 */
structure OuterProduct(dim: Nat) {
    operation outer : Ket(dim, â„‚) â†’ Bra(dim, â„‚) â†’ Operator(dim, â„‚)
}

implements OuterProduct(dim) {
    operation outer = builtin_outer_product
}

/* Quantum Operator
 * 
 * Operators act on quantum states: Ã‚|ÏˆâŸ© â†’ |Ï†âŸ©
 * 
 * Types of operators:
 *   - Hermitian: Ã‚â€  = Ã‚ (observables - real eigenvalues)
 *   - Unitary: Ã›â€ Ã› = ğŸ™ (time evolution - preserves norm)
 *   - Projection: PÌ‚Â² = PÌ‚ (measurement operators)
 * 
 * Type: Operator(dim, â„‚) - linear map â„‹ â†’ â„‹
 */
structure Operator(dim: Nat, T) {
    operation apply : Operator(dim, T) â†’ Ket(dim, T) â†’ Ket(dim, T)
    operation adjoint : Operator(dim, T) â†’ Operator(dim, T)
    operation compose : Operator(dim, T) â†’ Operator(dim, T) â†’ Operator(dim, T)
}

implements Operator(dim, â„‚) {
    operation apply = builtin_operator_apply
    operation adjoint = builtin_operator_adjoint
    operation compose = builtin_operator_compose
}

/* Commutator - Operator Algebra
 * 
 * [Ã‚, BÌ‚] = Ã‚BÌ‚ - BÌ‚Ã‚
 * 
 * Properties:
 *   - Antisymmetric: [Ã‚, BÌ‚] = -[BÌ‚, Ã‚]
 *   - Jacobi identity: [Ã‚,[BÌ‚,Äˆ]] + [BÌ‚,[Äˆ,Ã‚]] + [Äˆ,[Ã‚,BÌ‚]] = 0
 *   - Heisenberg: [xÌ‚, pÌ‚] = iâ„ (uncertainty principle!)
 * 
 * Physical meaning: Measures incompatibility of observables
 * [Ã‚, BÌ‚] = 0 âŸ¹ Ã‚ and BÌ‚ can be simultaneously measured
 */
structure Commutator(dim: Nat, T) {
    operation commutator : Operator(dim, T) â†’ Operator(dim, T) â†’ Operator(dim, T)
}

implements Commutator(dim, â„‚) {
    operation commutator = builtin_commutator
}

/* Expectation Value - Observable Measurement
 * 
 * âŸ¨Ã‚âŸ© = âŸ¨Ïˆ|Ã‚|ÏˆâŸ© for state |ÏˆâŸ©
 * 
 * Properties:
 *   - For Hermitian Ã‚: âŸ¨Ã‚âŸ© âˆˆ â„ (real measurement)
 *   - Average of many measurements
 *   - Uncertainty: Î”A = âˆš(âŸ¨Ã‚Â²âŸ© - âŸ¨Ã‚âŸ©Â²)
 * 
 * Physical meaning: Expected value of observable Ã‚ in state |ÏˆâŸ©
 * 
 * Note: Simplified signature - full version would include state:
 *   expectation : Operator(dim, â„‚) â†’ Ket(dim, â„‚) â†’ â„‚
 */
structure Expectation(dim: Nat) {
    operation expectation : Operator(dim, â„‚) â†’ â„‚
}

implements Expectation(dim) {
    operation expectation = builtin_expectation_value
}

/* Quantum Superposition
 * 
 * States can be superposed: Î±|ÏˆâŸ© + Î²|Ï†âŸ©
 * 
 * Properties:
 *   - Coefficients are complex: Î±, Î² âˆˆ â„‚
 *   - Normalization: |Î±|Â² + |Î²|Â² = 1
 *   - Interference: Superposition â‰  mixture
 */
structure Superposition(dim: Nat) {
    operation plus : Ket(dim, â„‚) â†’ Ket(dim, â„‚) â†’ Ket(dim, â„‚)
    operation scale : â„‚ â†’ Ket(dim, â„‚) â†’ Ket(dim, â„‚)
}

implements Superposition(dim) {
    operation plus = builtin_ket_add
    operation scale = builtin_ket_scale
}

/* Tensor Product - Composite Systems
 * 
 * |ÏˆâŸ© âŠ— |Ï†âŸ© represents composite quantum system.
 * 
 * Properties:
 *   - Dimensions multiply: dimâ‚ âŠ— dimâ‚‚ = dimâ‚ Ã— dimâ‚‚
 *   - Entanglement: Not all states are product states!
 *   - Separable: |ÏˆâŸ©âŠ—|Ï†âŸ© (product state)
 *   - Entangled: Î±|00âŸ© + Î²|11âŸ© (not separable)
 * 
 * Example: Two qubits: â„‹â‚‚ âŠ— â„‹â‚‚ = â„‹â‚„
 */
structure QuantumTensorProduct(dim1: Nat, dim2: Nat) {
    operation tensor : Ket(dim1, â„‚) â†’ Ket(dim2, â„‚) â†’ Ket(dim1, â„‚)
}

implements QuantumTensorProduct(dim1, dim2) {
    operation tensor = builtin_quantum_tensor_product
}

/* Measurement - State Collapse
 * 
 * Measuring observable Ã‚ on state |ÏˆâŸ©:
 *   - Result: One of eigenvalues Î»áµ¢
 *   - Probability: |âŸ¨Î»áµ¢|ÏˆâŸ©|Â²
 *   - Post-measurement: State collapses to |Î»áµ¢âŸ©
 * 
 * Born rule: P(Î»áµ¢) = |âŸ¨Î»áµ¢|ÏˆâŸ©|Â²
 */
structure Measurement(dim: Nat) {
    operation measure : Operator(dim, â„‚) â†’ Ket(dim, â„‚) â†’ â„
    operation collapse : Operator(dim, â„‚) â†’ Ket(dim, â„‚) â†’ Ket(dim, â„‚)
}

implements Measurement(dim) {
    operation measure = builtin_measure_expectation
    operation collapse = builtin_state_collapse
}

/* Common Quantum States
 * 
 * Standard basis states and important quantum states.
 */
structure StandardStates(dim: Nat) {
    operation ground : Ket(dim, â„‚)
    operation excited : Nat â†’ Ket(dim, â„‚)
    operation coherent : â„‚ â†’ Ket(dim, â„‚)
}

implements StandardStates(dim) {
    operation ground = builtin_ground_state
    operation excited = builtin_excited_state
    operation coherent = builtin_coherent_state
}

/* Common Quantum Operators
 * 
 * Standard operators for quantum mechanics.
 */
structure QuantumOperators(dim: Nat) {
    operation hamiltonian : Operator(dim, â„‚)
    operation momentum : Operator(dim, â„‚)
    operation position : Operator(dim, â„‚)
    operation angular_momentum : Operator(dim, â„‚)
    operation spin : Nat â†’ Operator(2, â„‚)
}

implements QuantumOperators(dim) {
    operation hamiltonian = builtin_hamiltonian
    operation momentum = builtin_momentum_op
    operation position = builtin_position_op
    operation angular_momentum = builtin_angular_momentum_op
    operation spin = builtin_spin_operator
}

/* Pauli Matrices - Spin-1/2 Systems
 * 
 * The Pauli matrices Ïƒx, Ïƒy, Ïƒz for qubits.
 * 
 * Properties:
 *   - ÏƒxÂ² = ÏƒyÂ² = ÏƒzÂ² = ğŸ™
 *   - {Ïƒx, Ïƒy} = 0 (anticommute)
 *   - [Ïƒx, Ïƒy] = 2iÏƒz (commutation relations)
 * 
 * Physical meaning: Spin-1/2 observables (electron, quark spin)
 */
structure PauliMatrices(T) {
    operation sigma_x : Operator(2, â„‚)
    operation sigma_y : Operator(2, â„‚)
    operation sigma_z : Operator(2, â„‚)
}

implements PauliMatrices(â„‚) {
    operation sigma_x = builtin_pauli_x
    operation sigma_y = builtin_pauli_y
    operation sigma_z = builtin_pauli_z
}

/* Time Evolution - SchrÃ¶dinger Equation
 * 
 * |Ïˆ(t)âŸ© = e^(-iÄ¤t/â„) |Ïˆ(0)âŸ©
 * 
 * Properties:
 *   - Unitary evolution: norm preserved
 *   - Hermitian Hamiltonian: energy conservation
 *   - Stationary states: Ä¤|EâŸ© = E|EâŸ©
 */
structure TimeEvolution(dim: Nat) {
    operation evolve : Operator(dim, â„‚) â†’ â„ â†’ Ket(dim, â„‚) â†’ Ket(dim, â„‚)
    operation propagator : Operator(dim, â„‚) â†’ â„ â†’ Operator(dim, â„‚)
}

implements TimeEvolution(dim) {
    operation evolve = builtin_time_evolution
    operation propagator = builtin_propagator
}

/* Density Matrix - Mixed States
 * 
 * ÏÌ‚ describes statistical mixtures of quantum states.
 * 
 * Properties:
 *   - Hermitian: ÏÌ‚â€  = ÏÌ‚
 *   - Positive: âŸ¨Ïˆ|ÏÌ‚|ÏˆâŸ© â‰¥ 0
 *   - Trace 1: Tr(ÏÌ‚) = 1
 *   - Pure state: ÏÌ‚Â² = ÏÌ‚ (idempotent)
 *   - Mixed state: ÏÌ‚Â² â‰  ÏÌ‚
 * 
 * Physical meaning: Statistical ensemble of quantum states
 */
structure DensityMatrix(dim: Nat) {
    operation from_ket : Ket(dim, â„‚) â†’ Operator(dim, â„‚)
    operation trace : Operator(dim, â„‚) â†’ â„‚
    operation purity : Operator(dim, â„‚) â†’ â„
}

implements DensityMatrix(dim) {
    operation from_ket = builtin_density_from_ket
    operation trace = builtin_operator_trace
    operation purity = builtin_density_purity
}

/* Entanglement - Non-Local Correlations
 * 
 * Quantum entanglement: States that cannot be written as products.
 * 
 * Example Bell state: (|00âŸ© + |11âŸ©)/âˆš2 â‰  |ÏˆâŸ©âŠ—|Ï†âŸ©
 * 
 * Measures:
 *   - Entanglement entropy: S = -Tr(ÏÌ‚ log ÏÌ‚)
 *   - Concurrence: Measure of two-qubit entanglement
 *   - Negativity: For continuous variables
 */
structure Entanglement(dim1: Nat, dim2: Nat) {
    operation entropy : Operator(dim1, â„‚) â†’ â„
    operation is_separable : Ket(dim1, â„‚) â†’ Bool
}

implements Entanglement(dim1, dim2) {
    operation entropy = builtin_entanglement_entropy
    operation is_separable = builtin_check_separable
}

/* Uncertainty Principle
 * 
 * Î”A Â· Î”B â‰¥ Â½|âŸ¨[Ã‚,BÌ‚]âŸ©|
 * 
 * For position and momentum: Î”x Â· Î”p â‰¥ â„/2
 * 
 * Physical meaning: Fundamental quantum limit on simultaneous measurements
 */
structure Uncertainty(dim: Nat) {
    operation uncertainty : Operator(dim, â„‚) â†’ Ket(dim, â„‚) â†’ â„
    operation heisenberg : Operator(dim, â„‚) â†’ Operator(dim, â„‚) â†’ Ket(dim, â„‚) â†’ â„
}

implements Uncertainty(dim) {
    operation uncertainty = builtin_uncertainty
    operation heisenberg = builtin_heisenberg_uncertainty
}

