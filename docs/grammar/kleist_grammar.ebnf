(* Kleist Template File Grammar - v0.1 *)
(* File extension: .kleist *)
(* Purpose: Define rendering templates and palette layouts *)

kleist_file = { block } ;

block = template_block | palette_block | comment ;

(* ============ TEMPLATE BLOCKS ============ *)

template_block = "@template" , identifier , "{" , template_body , "}" ;

template_body = { template_field } ;

template_field = field_name , ":" , field_value ;

field_name = "pattern" | "unicode" | "latex" | "html" | "typst" | "kleis" 
           | "category" | "shortcut" | "svg" | "glyph" ;

field_value = string_literal ;

(* ============ PALETTE BLOCKS ============ *)

palette_block = "@palette" , "{" , palette_body , "}" ;

palette_body = { tab_definition } ;

tab_definition = "tab" , string_literal , "{" , tab_body , "}" ;

tab_body = { tab_item } ;

tab_item = group_definition | template_reference | "separator" ;

group_definition = "group" , string_literal , "{" , group_body , "}" ;

group_body = { template_reference } ;

template_reference = identifier , [ template_options ] ;

template_options = shortcut_option ;

shortcut_option = "shortcut" , ":" , string_literal ;

(* ============ LEXICAL ELEMENTS ============ *)

identifier = letter , { letter | digit | "_" } ;

string_literal = '"' , { string_char } , '"' ;

string_char = ? any character except '"' or '\' ?
            | '\' , escape_char ;

escape_char = '"' | '\' | 'n' | 't' | '{' | '}' ;

comment = line_comment | block_comment ;

line_comment = "//" , { ? any character except newline ? } , newline ;

block_comment = "/*" , { ? any character ? } , "*/" ;

letter = "a" | ... | "z" | "A" | ... | "Z" ;

digit = "0" | ... | "9" ;

newline = ? newline character ? ;

